# pinentry-tty-wrapper テスト仕様書

## 概要

pinentry-tty-wrapper のテスト仕様を定義する。本テストは、特に環境依存の問題（termios の取得・書き込み失敗）を早期に発見し、デバッグを容易にすることを目的とする。

## テスト環境

- OS: Linux
- シェル: bash
- 必要なコマンド: make, python3, pytest

## テスト前提

- テスト時は test/ ディレクトリで実行し、pinentry-tty がシンボリックリンクであれば削除し、mock へのシンボリックリンクを張ることでテストを行う。

## テスト項目

### 1. 基本機能テスト

#### 1.1 子プロセス実行

- テスト名: `test_child_process`
- 目的: 子プロセスの生成と実行が正しく行われることを確認する。
- テストケース:
  1. 正常な pinentry-tty の実行
     - 期待結果: 子プロセスが正常に起動し、終了コードが正しく返される。
  2. 存在しない pinentry-tty の実行
     - 期待結果: エラーメッセージを表示して終了コード 1 で終了する。

### 2. 異常系テスト

#### 2.1 システムコールエラー

- テスト名: `test_tcgetattr_failure`
- 目的: tcgetattr 失敗時の動作を確認する。
- テストケース:
  1. tcgetattr 失敗
     - 期待結果: エラーメッセージを表示して終了コード 1 で終了する。
     - 確認事項: エラーメッセージから失敗の理由が分かること。

#### 2.2 GPG_TTY 未定義

- テスト名: `test_gpg_tty_undefined`
- 目的: GPG_TTY 環境変数が未定義の場合に正しくエラー終了することを確認する。
- テストケース:
  1. GPG_TTY 未定義で実行
     - 期待結果: 「GPG_TTY が未定義である」旨のエラーメッセージを表示し、終了コード 1 で終了する。

## テスト実装方針

1. テストプログラム
   - pytest を使用した自動テストとする。
   - mock を使用して termios の操作をモック化する。
   - fixture を使用してテストケースを実装する。
