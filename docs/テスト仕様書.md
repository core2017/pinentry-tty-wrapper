# pinentry-tty-wrapper テスト仕様書

## 概要

pinentry-tty-wrapper のテスト仕様を定義する。
本テストは、特に環境依存の問題（termiosの取得・書き込み失敗）を早期に発見し、
デバッグを容易にすることを目的とする。

## テスト環境

- OS: Linux
- シェル: bash
- 必要なコマンド: make

## テスト項目

### 1. 基本機能テスト

#### 1.1 子プロセス実行

- テスト名: `test_child_process`
- 目的: 子プロセスの生成と実行が正しく行われることを確認
- テストケース:
  1. 正常なpinentry-ttyの実行
     - 期待結果: 子プロセスが正常に起動し、終了コードが正しく返される
  2. 存在しないプログラムの実行
     - 期待結果: エラーメッセージを表示して終了コード1で終了

#### 1.2 コマンドライン引数

- テスト名: `test_command_line_args`
- 目的: コマンドライン引数の処理が正しく行われることを確認
- テストケース:
  1. 引数なし
     - 期待結果: 使用方法を表示して終了コード1で終了
  2. 引数が1つのみ（プログラム名のみ）
     - 期待結果: 使用方法を表示して終了コード1で終了
  3. 引数が2つ以上（プログラム名 + pinentry-tty + その他の引数）
     - 期待結果: 正常に実行される

#### 1.3 termios設定

- テスト名: `test_termios_settings`
- 目的: termiosの設定が正しく行われることを確認
- テストケース:
  1. ICRNLフラグの設定
     - 期待結果: 入力時のCRがLFに変換される
  2. OPOSTフラグの設定
     - 期待結果: 出力時の改行が正しく処理される

### 2. 異常系テスト

#### 2.1 システムコールエラー

- テスト名: `test_system_call_errors`
- 目的: システムコール失敗時の動作を確認
- テストケース:
  1. tcgetattr失敗
     - 期待結果: エラーメッセージを表示して終了コード1で終了
     - 確認事項: エラーメッセージから失敗の理由が分かること
  2. tcsetattr失敗
     - 期待結果: エラーメッセージを表示して終了コード1で終了
     - 確認事項: エラーメッセージから失敗の理由が分かること
  3. fork失敗
     - 期待結果: エラーメッセージを表示して終了コード1で終了
  4. waitpid失敗
     - 期待結果: エラーメッセージを表示して終了コード1で終了

#### 2.2 GPG_TTY未定義

- テスト名: `test_gpg_tty_undefined`
- 目的: GPG_TTY 環境変数が未定義の場合に正しくエラー終了することを確認
- テストケース:
  1. GPG_TTY 未定義で実行
     - 期待結果: 「GPG_TTY が未定義である」旨のエラーメッセージを表示し、終了コード1で終了

## テスト実装方針

1. テストプログラム
   - ローカル環境内での自動テスト
   - バイナリのみでテスト可能な設計

2. テスト実行方法
   ```bash
   make test
   ``` 